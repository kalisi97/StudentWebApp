@{
    ViewData["Title"] = "Home Page";
}

<link href="~/css/site.css" rel="stylesheet" />
<link href="https://cdn.datatables.net/1.10.22/css/jquery.dataTables.min.css" rel="stylesheet" />
<script type="text/javascript" src="~/lib/jquery/dist/jquery.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.0/jquery.validate.min.js"></script>

<div>
    <p>Click here to add new student</p>
    <a asp-action="Create" asp-controller="Students" class="btn btn-primary btn-outline-light">Add New Student</a>
</div>

<br />
<br />
<form class="form-inline" id="basic-form">
    <div class="form-group row">
        <input type="text" id="txtStudentId" placeholder="Student Id" style="display:none;" />

        <div class="form-group mb-2">
            <input type="text" id="txtFirstName" placeholder="Student Name" style="margin-right: 2px; display: none; " />
        </div>
        <div class="form-group mx-sm-2 mb-2">
            <input type="text" id="txtLastName" placeholder="Student Last Name" style="margin-right: 2px; display: none;" />
        </div>
    </div>

    <div class="form-group mx-sm-2 mb-2">
        <input type="text" id="txtIndexNumber" placeholder="Student Index Number" style="margin-left: 7px; display: none;" />
    </div>
    <div class="form-group mx-sm-2 mb-2">
        <input type="text" id="txtCity" placeholder="Student City" style="margin-right: 2px; display: none;" />
    </div>
    <div class="form-group mx-sm-2 mb-2">
        <input id="btnSave" type="submit" value="Save" class="btn btn-success" style="margin-right: 2px; display: none;" />
    </div>

</form>

<br />
<br />

<table id="tblStudents" class="table table-striped table-bordered">
    <thead>
        <tr>
            <th>Student Id</th>
            <th>First Name</th>
            <th>Last Name</th>
            <th>Index Number</th>
            <th>City</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
    </tbody>
</table>

<script type="text/javascript">
    $(document).ready(function () {
        var table =
            $('#tblStudents').DataTable({
                ajax: {
                    url: '/Students',
                    dataSrc: ''
                },
                columns: [
                    { data: 'StudentId' },
                    { data: 'FirstName' },
                    { data: 'LastName' },
                    { data: 'IndexNumber' },
                    { data: 'City' },
                    {
                        data: "id", render: function (data, typ, row, meta) {
                            return "<button class='btn btn-primary' style='margin-right: 2px;' onclick='Edit(" + JSON.stringify(row) + ")'>Edit</button>" +
                                "<button class='btn btn-danger' style='margin-right: 2px;' onclick='Delete(" + JSON.stringify(row) + ")'>Delete</button>";
                        }
                    }
                ]
            });

        $("#basic-form").submit(function (event) {

            event.preventDefault();

            var student = {
                StudentId: $("#txtStudentId").val(),
                FirstName: $("#txtFirstName").val(),
                LastName: $("#txtLastName").val(),
                IndexNumber: $("#txtIndexNumber").val(),
                City: $("#txtCity").val()
            };


            $.ajax({
                type: "POST",
                url: "/Students/Edit",
                data: JSON.stringify(student),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    Reset();
                    ReloadGrid();
                    alert(data);
                }
            });

        });

    });

    function Edit(oStudent) {

        var x1 = document.getElementById("txtFirstName");
        x1.style.display = "inline-block";
        var x2 = document.getElementById("txtLastName");
        x2.style.display = "inline-block";
        var x3 = document.getElementById("txtIndexNumber");
        x3.style.display = "inline-block";
        var x4 = document.getElementById("txtCity");
        x4.style.display = "inline-block";
        var x5 = document.getElementById("btnSave");
        x5.style.display = "inline-block";

        $("#txtStudentId").val(oStudent.StudentId);
        $("#txtFirstName").val(oStudent.FirstName);
        $("#txtLastName").val(oStudent.LastName);
        $("#txtIndexNumber").val(oStudent.IndexNumber);
        $("#txtCity").val(oStudent.City);
    }


    function Delete(oStudent) {

        var result = confirm("Are you sure you want to delete student" + oStudent.FirstName + " " + oStudent.LastName + " ?");
        if (result) {
            $.post("/Students/Delete", { id: oStudent.StudentId },
                function (data) {
                    ReloadGrid();
                    alert(data);
                });
        }
    }
    function Reset() {
        $("#txtStudentId").val(0);
        $("#txtFirstName").val("");
        $("#txtLastName").val("");
        $("#txtIndexNumber").val("");
        $("#txtCity").val("");

        var x1 = document.getElementById("txtFirstName");
        x1.style.display = "none";
        var x2 = document.getElementById("txtLastName");
        x2.style.display = "none";
        var x3 = document.getElementById("txtIndexNumber");
        x3.style.display = "none";
        var x4 = document.getElementById("txtCity");
        x4.style.display = "none";
        var x5 = document.getElementById("btnSave");
        x5.style.display = "none";

    }
    function ReloadGrid() {
        $('#tblStudents').DataTable().clear();
        $('#tblStudents').DataTable().ajax.reload();
    }
</script>